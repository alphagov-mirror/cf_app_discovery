---
defaults: &defaults
  buildpack: ruby_buildpack
  memory: 512MB
  instances: 1
  services:
    - prometheus-targets-access-dev
  env:
    AWS_REGION: eu-west-1
    API_ENDPOINT: https://api.cloud.service.gov.uk
    UAA_ENDPOINT: https://uaa.cloud.service.gov.uk
    PAAS_DOMAIN: cloudapps.digital
    TARGETS_PATH: none
    ENVIRONMENT: paas
    BUCKET_NAME: gds-prometheus-targets-dev
    SERVICE_ID: c6221308-b7bb-46d2-9d79-a357f5a3837b
    SERVICE_NAME: gds-prometheus-dev
    PLAN_ID: 7ab58e11-3959-49b4-9218-807e3e78f9af

applications:
  - name: prometheus-service-broker-dev
    <<: *defaults
    command: export $(./load_access.rb) && bundle exec rackup -o 0.0.0.0 -p $PORT
  - name: prometheus-target-updater-dev
    <<: *defaults
    command: export $(./load_access.rb) && bundle exec clockwork bin/clock.rb
    health-check-type: process
